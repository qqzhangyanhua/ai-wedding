# ç»“æœé¡µé¢æ›´æ–° - ä½¿ç”¨çœŸå®æ•°æ®

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

å°† `ResultsPage.tsx` ä»ä½¿ç”¨æµ‹è¯•æ•°æ®æ”¹ä¸ºåªä½¿ç”¨çœŸå®æ•°æ®ï¼Œå¹¶æ·»åŠ äº†å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç©ºçŠ¶æ€æ˜¾ç¤ºã€‚

## ğŸ”§ ä¸»è¦æ”¹åŠ¨

### 1. ç§»é™¤æµ‹è¯•æ•°æ®å›é€€

**ä¹‹å‰çš„ä»£ç ï¼š**
```typescript
const mockResults = [
  'https://images.pexels.com/photos/338515/...',
  // ... 12 å¼ æµ‹è¯•å›¾ç‰‡
];

const resultsPreview = generation?.preview_images && generation.preview_images.length > 0
  ? generation.preview_images
  : mockResults; // âŒ å›é€€åˆ°æµ‹è¯•æ•°æ®
```

**ä¿®æ”¹åï¼š**
```typescript
// âœ… åªä½¿ç”¨çœŸå®æ•°æ®ï¼Œä¸ä½¿ç”¨æµ‹è¯•æ•°æ®
const resultsPreview = generation?.preview_images || [];
const resultsHigh = generation?.high_res_images || [];
const currentImages = tab === 'preview' ? resultsPreview : resultsHigh;
```

### 2. æ·»åŠ é”™è¯¯çŠ¶æ€å¤„ç†

æ–°å¢ `error` çŠ¶æ€å’Œé”™è¯¯å¤„ç†é€»è¾‘ï¼š

```typescript
const [error, setError] = useState<string | null>(null);

// åœ¨æ•°æ®åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯é¡µé¢
if (error) {
  return (
    <div className="min-h-screen ...">
      <GlassCard className="p-8 text-center">
        <AlertCircle className="w-8 h-8 text-red-600" />
        <h2>åŠ è½½å¤±è´¥</h2>
        <p>{error}</p>
        <button onClick={() => onNavigate('dashboard')}>
          è¿”å›ä»ªè¡¨ç›˜
        </button>
      </GlassCard>
    </div>
  );
}
```

### 3. æ·»åŠ ç©ºçŠ¶æ€æ˜¾ç¤º

å½“æ²¡æœ‰å›¾ç‰‡æ•°æ®æ—¶ï¼Œæ˜¾ç¤ºå‹å¥½çš„æç¤ºï¼š

```typescript
if (!generation || currentImages.length === 0) {
  return (
    <div className="min-h-screen ...">
      <GlassCard className="p-12 text-center">
        <Sparkles className="w-10 h-10" />
        <h2>{generation ? 'å›¾ç‰‡ç”Ÿæˆä¸­' : 'æœªæ‰¾åˆ°ç”Ÿæˆç»“æœ'}</h2>
        <p>
          {generation?.status === 'processing' 
            ? 'æ‚¨çš„å©šçº±ç…§æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™ç‰‡åˆ»...'
            : generation?.status === 'pending'
            ? 'æ‚¨çš„è¯·æ±‚æ­£åœ¨é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šå¼€å§‹ç”Ÿæˆ...'
            : generation?.status === 'failed'
            ? 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•æˆ–è”ç³»å®¢æœ'
            : tab === 'high_res'
            ? 'é«˜æ¸…å›¾ç‰‡éœ€è¦è´­ä¹°åæ‰èƒ½æŸ¥çœ‹'
            : 'å½“å‰æ²¡æœ‰å¯ç”¨çš„å›¾ç‰‡'
          }
        </p>
        <button onClick={() => onNavigate('dashboard')}>
          è¿”å›ä»ªè¡¨ç›˜
        </button>
        {generation?.status === 'processing' && (
          <button onClick={() => window.location.reload()}>
            <Repeat /> åˆ·æ–°é¡µé¢
          </button>
        )}
      </GlassCard>
    </div>
  );
}
```

### 4. å¢å¼ºæ—¥å¿—è®°å½•

åœ¨æ•°æ®åŠ è½½æ—¶æ·»åŠ è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼š

```typescript
console.log('æ­£åœ¨åŠ è½½ç”Ÿæˆç»“æœï¼ŒID:', generationId);

console.log('ç”Ÿæˆç»“æœæ•°æ®:', {
  id: data.id,
  status: data.status,
  preview_images_count: data.preview_images?.length || 0,
  high_res_images_count: data.high_res_images?.length || 0,
});
```

### 5. æ›´æ–°å›¾ç‰‡æ•°é‡æ˜¾ç¤º

ç¡®ä¿æ‰€æœ‰åœ°æ–¹éƒ½ä½¿ç”¨çœŸå®çš„å›¾ç‰‡æ•°é‡ï¼š

```typescript
// æ ‡é¢˜ä¸­çš„å›¾ç‰‡æ•°é‡
<p>æˆ‘ä»¬ä¸ºæ‚¨ç”Ÿæˆäº† {currentImages.length} å¼ ç²¾ç¾å©šçº±ç…§</p>

// åˆ†äº«å¼¹çª—ä¸­çš„å›¾ç‰‡æ•°é‡
{showShareModal && generation && currentImages.length > 0 && (
  <ShareModal
    imageUrl={currentImages[0] || ''}
    imageCount={currentImages.length}
    ...
  />
)}
```

## ğŸ“Š çŠ¶æ€å¤„ç†æµç¨‹

```
ç”¨æˆ·è®¿é—® /results/[id]
    â†“
æ£€æŸ¥ generationId
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»æ•°æ®åº“åŠ è½½ç”Ÿæˆè®°å½•        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŠ è½½ä¸­          â”‚  æˆåŠŸ     â”‚   å¤±è´¥     â”‚
â”‚  æ˜¾ç¤ºéª¨æ¶å±      â”‚           â”‚  æ˜¾ç¤ºé”™è¯¯  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ£€æŸ¥æ˜¯å¦æœ‰å›¾ç‰‡æ•°æ®        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æœ‰å›¾ç‰‡      â”‚   æ— å›¾ç‰‡    â”‚
        â”‚  æ˜¾ç¤ºç”»å»Š    â”‚  æ˜¾ç¤ºç©ºçŠ¶æ€  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ”¯æŒçš„ç”ŸæˆçŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ | ç”¨æˆ·ä½“éªŒ |
|------|------|----------|
| `pending` | è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­ | æ˜¾ç¤º"é©¬ä¸Šå¼€å§‹ç”Ÿæˆ"ï¼Œå¯åˆ·æ–° |
| `processing` | æ­£åœ¨ç”Ÿæˆä¸­ | æ˜¾ç¤º"æ­£åœ¨ç”Ÿæˆä¸­"ï¼Œå¯åˆ·æ–° |
| `completed` | ç”Ÿæˆå®Œæˆ | æ˜¾ç¤ºå›¾ç‰‡ç”»å»Š |
| `failed` | ç”Ÿæˆå¤±è´¥ | æ˜¾ç¤º"ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•" |

## ğŸ” è°ƒè¯•æ–¹æ³•

### 1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

```javascript
æ­£åœ¨åŠ è½½ç”Ÿæˆç»“æœï¼ŒID: 12345678-1234-1234-1234-123456789abc
ç”Ÿæˆç»“æœæ•°æ®: {
  id: "12345678-1234-1234-1234-123456789abc",
  status: "completed",
  preview_images_count: 4,
  high_res_images_count: 0
}
```

### 2. æ£€æŸ¥æ•°æ®åº“

```sql
-- æŸ¥çœ‹ç”Ÿæˆè®°å½•
SELECT 
  id,
  status,
  preview_images,
  high_res_images,
  completed_at
FROM generations
WHERE id = 'ä½ çš„-generation-id';

-- æ£€æŸ¥ preview_images æ˜¯å¦ä¸ºç©ºæ•°ç»„æˆ– NULL
SELECT 
  preview_images IS NULL as is_null,
  array_length(preview_images, 1) as image_count
FROM generations
WHERE id = 'ä½ çš„-generation-id';
```

### 3. å¸¸è§é—®é¢˜æ’æŸ¥

#### é—®é¢˜ 1: æ˜¾ç¤º"æœªæ‰¾åˆ°ç”Ÿæˆç»“æœ"

**åŸå› ï¼š**
- generation ä¸º null
- generationId æ— æ•ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ URL ä¸­çš„ ID æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨è¯¥è®°å½•

#### é—®é¢˜ 2: æ˜¾ç¤º"å½“å‰æ²¡æœ‰å¯ç”¨çš„å›¾ç‰‡"

**åŸå› ï¼š**
- `preview_images` ä¸ºç©ºæ•°ç»„
- å›¾ç‰‡ç”Ÿæˆå¤±è´¥ä½†çŠ¶æ€æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆï¼š**
```sql
-- æ£€æŸ¥å›¾ç‰‡æ•°æ®
SELECT preview_images FROM generations WHERE id = 'xxx';

-- å¦‚æœä¸ºç©ºï¼Œæ£€æŸ¥ç”Ÿæˆæ—¥å¿—
SELECT error_message FROM generations WHERE id = 'xxx';
```

#### é—®é¢˜ 3: åˆ‡æ¢åˆ°"é«˜æ¸…"æ ‡ç­¾æ˜¾ç¤ºç©ºçŠ¶æ€

**åŸå› ï¼š**
- `high_res_images` ä¸ºç©ºï¼ˆæ­£å¸¸è¡Œä¸ºï¼‰
- é«˜æ¸…å›¾ç‰‡éœ€è¦è´­ä¹°åæ‰è§£é”

**è¯´æ˜ï¼š**
è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼Œç”¨æˆ·éœ€è¦è´­ä¹°åæ‰èƒ½æŸ¥çœ‹é«˜æ¸…å›¾ç‰‡ã€‚

## âœ… éªŒè¯æ¸…å•

åœ¨éƒ¨ç½²å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] åŠ è½½çœŸå®çš„ generation æ•°æ®
- [ ] ä¸æ˜¾ç¤ºæµ‹è¯•å›¾ç‰‡
- [ ] é”™è¯¯çŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- [ ] ç©ºçŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- [ ] å›¾ç‰‡æ•°é‡æ­£ç¡®æ˜¾ç¤º
- [ ] æ§åˆ¶å°æ—¥å¿—è¾“å‡ºæ­£ç¡®
- [ ] é«˜æ¸…/é¢„è§ˆåˆ‡æ¢æ­£å¸¸
- [ ] åˆ†äº«åŠŸèƒ½æ­£å¸¸

## ğŸ“ ä»£ç ç¤ºä¾‹

### æ£€æŸ¥ç”Ÿæˆè®°å½•æ˜¯å¦å­˜åœ¨

```typescript
const { data, error } = await supabase
  .from('generations')
  .select(`
    *,
    project:projects(name, uploaded_photos),
    template:templates(name)
  `)
  .eq('id', generationId)
  .maybeSingle();

if (error) throw error;

if (!data) {
  throw new Error('æœªæ‰¾åˆ°ç”Ÿæˆè®°å½•');
}
```

### å®‰å…¨åœ°æ¸²æŸ“å›¾ç‰‡

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å¯é€‰é“¾å’Œé»˜è®¤å€¼
const images = generation?.preview_images || [];

// âŒ é”™è¯¯ï¼šç›´æ¥è®¿é—®å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
const images = generation.preview_images; // å¦‚æœ generation ä¸º null ä¼šæŠ¥é”™
```

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **å®æ—¶æ›´æ–°**ï¼šä½¿ç”¨ Supabase Realtime ç›‘å¬ç”ŸæˆçŠ¶æ€å˜åŒ–
2. **è½®è¯¢æœºåˆ¶**ï¼šå¯¹äº `processing` çŠ¶æ€ï¼Œå®šæ—¶åˆ·æ–°æ•°æ®
3. **è¿›åº¦æ˜¾ç¤º**ï¼šæ˜¾ç¤ºç”Ÿæˆè¿›åº¦ç™¾åˆ†æ¯”
4. **é”™è¯¯é‡è¯•**ï¼šå¯¹äºå¤±è´¥çš„ç”Ÿæˆï¼Œæä¾›ä¸€é”®é‡è¯•åŠŸèƒ½

---

**æ›´æ–°æ—¶é—´**: 2025-10-11  
**å½±å“èŒƒå›´**: `src/views/ResultsPage.tsx`  
**æµ‹è¯•çŠ¶æ€**: âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡ï¼Œâœ… ESLint æ£€æŸ¥é€šè¿‡





